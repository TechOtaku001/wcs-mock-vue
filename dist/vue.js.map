{"version":3,"file":"vue.js","sources":["../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["\r\nexport function observer(data) {\r\n  console.info('data to be observed ', data)\r\n\r\n  // data 中的数据如果不是对象类型则不需要劫持\r\n  if (typeof data != 'object' || data == null) {\r\n    return data\r\n  }\r\n\r\n  // 真正对 data 进行劫持的是在 Observer 类中进行\r\n  return new Observer(data)\r\n}\r\n\r\n// Object.defineProperty 只能对对象的单个属性进行劫持\r\n// 所以需要遍历 data 属性\r\nclass Observer {\r\n  constructor(val) {\r\n    this.walk(val)\r\n  }\r\n\r\n  walk(obj) {\r\n    let keys = Object.keys(obj)\r\n    \r\n    for(let i = 0; i < keys.length; i++) {\r\n      let key = keys[i]\r\n      let value = obj[key]\r\n      defineReactive(obj, key, value)\r\n    }\r\n  }\r\n}\r\n\r\n// 对对象中的属性进行劫持\r\nfunction defineReactive(obj, key, val) {\r\n  // Object.defineProperty 只能对对象的单个属性进行劫持\r\n  // 所以需要递归调用，进行深度劫持\r\n  observer(val)\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      console.info('获取响应式数据' + val)\r\n      return val\r\n    },\r\n    set(newVal) {\r\n      if (newVal === val) {\r\n        return\r\n      }\r\n      // Object.defineProperty 无法对新增的对象类型数据进行劫持\r\n      // 所以在赋值的时候也需要进行递归调用以深度劫持\r\n      observer(newVal)\r\n      val = newVal\r\n    }\r\n  })\r\n}\r\n","import { observer } from \"./observe/index\"\r\n\r\nexport function initState(vm) {\r\n  let opts = vm.$options\r\n\r\n  if (opts.props) {\r\n    initProps()\r\n  }\r\n\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n\r\n  if (opts.watch) {\r\n    initWatch()\r\n  }\r\n\r\n  if (opts.computed) {\r\n    initComputed()\r\n  }\r\n\r\n  if (opts.methods) {\r\n    initMethods()\r\n  }\r\n\r\n}\r\n\r\nfunction initProps(){}\r\n\r\nfunction initData(vm){\r\n  console.info('初始化 data')\r\n  let data = vm.$options.data\r\n  // 如果 data 是个函数，则在调用时要注意 this 的指向问题\r\n  data = vm._data =  typeof data === 'function' ? data.call(vm) : data\r\n\r\n  // 对数据进行劫持\r\n  observer(data)\r\n}\r\n\r\nfunction initWatch(){}\r\n\r\nfunction initComputed(){}\r\n\r\nfunction initMethods(){}\r\n","import { initState } from \"./initState\"\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    console.info(\"options ==> \", options)\r\n    let vm = this\r\n    vm.$options = options\r\n    // 初始化状态\r\n    initState(vm)\r\n  }\r\n}","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue\r\n"],"names":["observer","data","console","info","Observer","val","walk","obj","keys","Object","i","length","key","value","defineReactive","defineProperty","get","set","newVal","initState","vm","opts","$options","props","initData","watch","computed","methods","_data","call","initMixin","Vue","prototype","_init","options"],"mappings":"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"}