{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayProtoMethods = Array.prototype\r\n\r\nlet arrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\nlet methods = ['push', 'pop', 'unshift', 'shift', 'splice']\r\n\r\nmethods.forEach(item => {\r\n  arrayMethods[item] = function (...args) {\r\n    console.log('进行数组方法劫持')\r\n    // 在此写入劫持数组的逻辑\r\n    let result = oldArrayProtoMethods[item].apply(this, args)\r\n\r\n    let inserted\r\n    switch (item) {\r\n      case 'push':\r\n      case 'unshift':\r\n        inserted = args\r\n        break\r\n      case 'splice':\r\n        inserted = args.splice(2)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n    console.info('this in array proxy ', this)\r\n    let ob = this.__ob__\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n\r\n    return result\r\n  }\r\n})\r\n\r\nexport default arrayMethods\r\n","import arrayMethods from \"./array\"\r\n\r\nexport function observer(data) {\r\n  console.info('data to be observed ', data)\r\n\r\n  // data 中的数据如果不是对象类型则不需要劫持\r\n  if (typeof data != 'object' || data == null) {\r\n    return data\r\n  }\r\n\r\n  // 真正对 data 进行劫持的是在 Observer 类中进行\r\n  return new Observer(data)\r\n}\r\n\r\n// Object.defineProperty 只能对对象的单个属性进行劫持\r\n// 所以需要遍历 data 属性\r\nclass Observer {\r\n  constructor(val) {\r\n\r\n    Object.defineProperty(val, '__ob__', {\r\n      enumerable: false,\r\n      value: this\r\n    })\r\n\r\n    if (Array.isArray(val)) {\r\n      val.__proto__ = arrayMethods\r\n      this.observeArray(val)\r\n    } else {\r\n      this.walk(val)\r\n    }\r\n  }\r\n\r\n  walk(obj) {\r\n    let keys = Object.keys(obj)\r\n    \r\n    for(let i = 0; i < keys.length; i++) {\r\n      let key = keys[i]\r\n      let value = obj[key]\r\n      defineReactive(obj, key, value)\r\n    }\r\n  }\r\n  observeArray(array) {\r\n    for(let i = 0; i < array.length; i++) {\r\n      observer(array[i])\r\n    }\r\n  }\r\n}\r\n\r\n// 对对象中的属性进行劫持\r\nfunction defineReactive(obj, key, val) {\r\n  // Object.defineProperty 只能对对象的单个属性进行劫持\r\n  // 所以需要递归调用，进行深度劫持\r\n  observer(val)\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      console.info('获取响应式数据' + val)\r\n      return val\r\n    },\r\n    set(newVal) {\r\n      if (newVal === val) {\r\n        return\r\n      }\r\n      // Object.defineProperty 无法对新增的对象类型数据进行劫持\r\n      // 所以在赋值的时候也需要进行递归调用以深度劫持\r\n      observer(newVal)\r\n      val = newVal\r\n    }\r\n  })\r\n}\r\n","import { observer } from \"./observe/index\"\r\n\r\nexport function initState(vm) {\r\n  let opts = vm.$options\r\n\r\n  if (opts.props) {\r\n    initProps()\r\n  }\r\n\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n\r\n  if (opts.watch) {\r\n    initWatch()\r\n  }\r\n\r\n  if (opts.computed) {\r\n    initComputed()\r\n  }\r\n\r\n  if (opts.methods) {\r\n    initMethods()\r\n  }\r\n\r\n}\r\n\r\nfunction initProps(){}\r\n\r\nfunction initData(vm){\r\n  console.info('初始化 data')\r\n  let data = vm.$options.data\r\n  // 如果 data 是个函数，则在调用时要注意 this 的指向问题\r\n  data = vm._data =  typeof data === 'function' ? data.call(vm) : data\r\n\r\n  // 对数据进行劫持\r\n  observer(data)\r\n}\r\n\r\nfunction initWatch(){}\r\n\r\nfunction initComputed(){}\r\n\r\nfunction initMethods(){}\r\n","import { initState } from \"./initState\"\r\n\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function(options) {\r\n    console.info(\"options ==> \", options)\r\n    let vm = this\r\n    vm.$options = options\r\n    // 初始化状态\r\n    initState(vm)\r\n  }\r\n}","import { initMixin } from \"./init\"\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue\r\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","item","console","log","args","result","apply","inserted","splice","info","ob","__ob__","observeArray","observer","data","Observer","val","defineProperty","enumerable","value","isArray","__proto__","walk","obj","keys","i","length","key","defineReactive","array","get","set","newVal","initState","vm","opts","$options","props","initData","watch","computed","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}